$(document).ready((function(){const e=document.getElementById("navigation_mobile");let t=0;window.addEventListener("scroll",(function(){let a=window.pageYOffset||document.documentElement.scrollTop;e.style.bottom=a>t?"-72px":"0",t=a<=0?0:a;const o=document.getElementById("ds_panel_header"),i=document.getElementById("ds_panel_body");window.scrollY>=95?(o.style.position="fixed",o.style.top="0",i.style.marginTop="80px"):(o.style.position="static",o.style.top="unset",i.style.marginTop="0px")}));let a=document.getElementById("ds_panel_header"),o=document.getElementById("search_names"),i=document.getElementById("close_search");function n(e){const t=`${["Domingo","Lunes","Martes","Miércoles","Jueves","Viernes","Sábado"][e.getDay()]} ${e.getDate()} de ${["Enero","Febrero","Marzo","Abril","Mayo","Junio","Julio","Agosto","Sept","Oct","Nov","Dic"][e.getMonth()]}, ${e.getFullYear()}`;document.getElementById("date_of_activity_text").innerHTML=t}function s(e){let t=e.trim().split(":");if(t.length<2)return"Hora inválida";let a=parseInt(t[0],10),o=parseInt(t[1],10),i=a>=12?"p.m":"a.m";return a%=12,a=a||12,o=o<10?"0"+o:o,a+":"+o+" "+i}function c(e){$(".activity_row").each((function(){e==$(this).data("date-act")?$(this).removeClass("d-none"):$(this).addClass("d-none")}))}o.addEventListener("focusin",(function(){a.classList.add("search_active")})),o.addEventListener("focusout",(function(){a.classList.remove("search_active"),o.value="",c($("#date_of_activity_selector").val())})),i.addEventListener("click",(function(){a.classList.remove("search_active"),o.value=""})),$("#search_names").on("input",(function(){const e=this.value.trim().toLowerCase(),t=new Date($("#date_of_activity_selector").val());$(".activity_row").each((function(){const a=this,o=a.children[3].children[0].innerText.trim().toLowerCase(),i=a.children[2].children[0].innerText.trim().toLowerCase(),n=new Date($(a).data("date-act")).toDateString()===t.toDateString(),s=""===e||o.includes(e)||i.includes(e);n&&s?$(a).removeClass("d-none"):$(a).addClass("d-none")}))})),$("#filter_activity input").on("input",(function(){let e=this.id,t=$("#date_of_activity_selector").val()||new Date;$(".activity_row").each((function(){let a=$(this).data("kind-act"),o=$(this).data("date-act"),i=$(this);function n(e){a==e&&o==t?i.removeClass("d-none"):(console.log(o),console.log(t),i.addClass("d-none"))}switch(e){case"see_all_activity":c(t);break;case"see_key_retiros":n("1");break;case"see_key_devoluciones":n("2");break;case"see_key_solicitudes":n("3")}}))})),$("#date_of_activity_selector").on("input",(function(){const e=$(this).val();if(e){if(!/^\d{4}-\d{2}-\d{2}$/.test(e))return void console.error("Formato de fecha incorrecto:",e);const t=e.split("-");n(new Date(t[0],t[1]-1,t[2]))}$("#search_names").val(""),$("#see_all_activity").prop("checked",!0)})),function(){const e=new Date;e.setHours(e.getUTCHours()),n(e)}(),document.querySelectorAll(".act_time .act_data_cont").forEach((e=>{e.innerHTML=s(e.innerHTML)})),flatpickr("#date_of_activity_selector",{locale:"es",defaultDate:"today",disableMobile:!0}),$(".btn_see_more").on("click",(function(){const e=$("#title_see_act"),t=$(this).data("professor"),a=$(this).data("time");let o=$(this).data("date");const i=new Date(o);i.setDate(i.getDate()+1);const n=i.toLocaleDateString("es-ES",{weekday:"long",year:"numeric",month:"long",day:"numeric"});o=n.charAt(0).toUpperCase()+n.slice(1);const c=$(this).data("kind"),l=$(this).data("key1"),d=$(this).data("key2"),r=$(this).data("key3"),_=$(this).data("key4"),u=$(this).data("key5"),h=$(this).data("cond-sol-llave"),v=$(this).data("cond-sol-horain-llave"),m=$(this).data("cond-sol-horafin-llave"),f=$(this).data("razon-llave-solicitada"),y=$(this).data("key-solicitada"),p=$(this).data("key-fecha-uso-solicitud"),g=$(this).data("codigo-gravedad"),w=$(this).data("bitacora"),b=$(this).data("razon-devolucion");if($(".act_data_atr").text(""),$(".retiro, .devolucion, .solicitud").hide(),$("#act_data_profesor").text(t),$("#act_fecha_hora").text(`${o} - ${s(a)}`),"Retiro de llave"===c){e.text("Detalles de Retiro"),$(".retiro").show();const t=[l,d,r,_,u].filter((e=>e)),a=t.length?t.map((e=>`<span>${e}</span>`)).join(""):"<span>No hay llaves retiradas</span>";$("#act_data_llaves").html(a)}else if("Devolución de llave"===c){e.text("Detalles de Devolución"),$(".devolucion").show();const t=[l,d,r,_,u].filter((e=>e)),a=t.length?t.map((e=>`<span>${e}</span>`)).join(""):"<spans>No hay llaves devueltas</spans>";switch($("#act_data_llaves").html(a),$("#cond_buena, #cond_intermedia, #cond_grave").hide(),"1"==g?$("#cond_buena").show():"2"==g?$("#cond_intermedia").show():"3"==g&&$("#cond_grave").show(),$("#act_data_bitacora").text(w||"Sin bitácora"),b){default:$("#act_razon_devolucion").text(b);break;}}else"Solicitud de llave"===c&&(e.text("Detalles de Solicitud"),$(".solicitud").show(),$("#act_data_llave_solicitada").text(y||"No hay llave solicitada"),$("#act_data_fecha_uso").text(p||"Sin fecha de uso"),$("#act_hora_uso_in_sl").text(`${s(v)}`),$("#act_hora_uso_fin_sl").text(`${s(m)}`),$("#act_justificacion_sl").text(f),1==h?($("#cond_sol_aprobed").show(),$("#cond_sol_rejected").hide()):($("#cond_sol_aprobed").hide(),$("#cond_sol_rejected").show()))})),$("#date_of_activity_selector").on("input",(function(){c($(this).val())}))}));