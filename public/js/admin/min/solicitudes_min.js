$(document).ready((function(){const e=new Audio("./public/assets/audio/success.mp3"),a=document.getElementById("navigation_mobile");let t=0;function o(e){switch(e){case 1:$("#inbox_aulas").addClass("d-none"),$("#inbox_registro").removeClass("d-none"),$("#btn_inbox_llaves").removeClass("s_inbox_active"),$("#btn_inbox_registros").addClass("s_inbox_active");break;case 2:$("#inbox_registro").addClass("d-none"),$("#inbox_aulas").removeClass("d-none"),$("#btn_inbox_registros").removeClass("s_inbox_active"),$("#btn_inbox_llaves").addClass("s_inbox_active")}}window.addEventListener("scroll",(function(){let e=window.pageYOffset||document.documentElement.scrollTop;a.style.bottom=e>t?"-72px":"0",t=e<=0?0:e})),$("#btn_inbox_registros").on("click",(function(){o(1)})),$("#btn_inbox_llaves").on("click",(function(){o(2)}));let r="",s="",i="",d="";document.querySelectorAll(".sol_btn_process").forEach((e=>{e.addEventListener("click",(function(){r=e.attributes["data-us_ced"].value,s=e.attributes["data-us_ci"].value,i=e.attributes["data-us_rol"].value,d=e.attributes["data-us_lphoto"].value,$("#rg_user_ced .rg_info_val").html(e.attributes["data-us_ced"].value),$("#rg_user_nom .rg_info_val").html(e.attributes["data-us_nom"].value),$("#rg_user_ci .rg_info_val").html(e.attributes["data-us_ci"].value),$("#rg_user_rol .rg_info_val").html(e.attributes["data-us_rol"].value),"Administrador"==e.attributes["data-us_rol"].value?$("#rg_user_esp").removeClass("d-flex").addClass("d-none"):($("#rg_user_esp .rg_info_val").html(e.attributes["data-us_esp"].value),$("#rg_user_esp").addClass("d-flex").removeClass("d-none")),$("#rg_user_telct .rg_info_val").html(e.attributes["data-us_tlc"].value),$("#rg_user_mailct .rg_info_val").html(e.attributes["data-us_mlc"].value),$("#rg_user_photo").attr("src",e.attributes["data-us_lphoto"].value)}))})),$("#confirm_deny_check").on("change",(function(){$("#confirm_deny_check").prop("checked")?$("#deny_rg_sl").attr("disabled",!1):$("#deny_rg_sl").attr("disabled",!0)})),$("#deny_feedback_check").on("change",(function(){$("#deny_feedback_check").prop("checked")?$("#deny_feedback").attr("disabled",!1):$("#deny_feedback").attr("disabled",!0)})),$("#deny_rg_sl").on("click",(function(){$("#deny_rg_sl").attr("disabled",!0),$("#sc_reg_aprobar").attr("disabled",!0),$("#deny_rg_sl").html("Procesando...");let a=""!==$("#deny_feedback").val()&&$("#deny_feedback").val();$.ajax({url:"admin_solicitudes",type:"POST",data:{action_type:"deny_rg",ced_rechazo:r,correo_ins:s,razon_rechazo:a,rol:i,photo_rg:d},success:function(a){e.play(),"success"==a&&($("#md_proc_registro").modal("hide"),$("#md_rechazar_registro").modal("hide"),$("#md_info_proceso").modal("show"),$("#info_proc_text").html("El rechazo de la solicitud de registro ha sido existoso."))},error:function(e){}})})),$("#sc_reg_aprobar").on("click",(function(){$("#sc_reg_rechazar").attr("disabled",!0),$("#sc_reg_aprobar").attr("disabled",!0),$("#sc_reg_aprobar").html("Procesando..."),$.ajax({url:"admin_solicitudes",type:"POST",data:{action_type:"accept_rg",correo_ins:s,ced_aprobado:r},success:function(a){e.play(),$("#md_proc_registro").modal("hide"),$("#md_info_proceso").modal("show"),"success"==a?"Administrador"==i?$("#info_proc_text").html("La solicitud de registro fue aprobada con éxito."):$("#info_proc_text").html("La solicitud de registro fue aprobada con éxito. <br><br>Para asignar los datos relacionados al horario de este usuario, debe ir a la sección de <b>Perfiles</b>, seleccionar el perfil e ingresar al apartado de <b>Horario</b>."):$("#info_proc_text").html("La solicitud de registro no se pudo realizar.")},error:function(e){console.log(e)}})})),$(".accept_sol, .deny_sol").click((function(){$(".accept_sol, .deny_sol").prop("disabled",!0),$(this).html("Procesando...");const a=$(this).parent().children()[0],t={idSolicitud:a.getAttribute("data-id-solicitud"),cedulaUsuario:a.getAttribute("data-ced-prof"),fechaEmision:a.getAttribute("data-date-in"),horaEmision:a.getAttribute("data-time-in"),numeroLlave:a.getAttribute("data-key"),fechaUtilizacion:a.getAttribute("data-date-use"),horaInicio:a.getAttribute("data-time-init"),horaFinal:a.getAttribute("data-time-finish"),razonUso:a.getAttribute("data-justify"),accion:$(this).hasClass("accept_sol")?"aceptar":"rechazar"};$.ajax({url:"admin_solicitudes",type:"POST",data:{action_type:"process_key_req",requestData:t},success:function(a){$("#md_info_proceso").modal("show"),e.play(),a?"aceptar"==t.accion?$("#info_proc_text").html("La solicitud se ha aprobado con éxito, en caso de ser necesario, recuerde al usuario que, el estado de esta solicitud se encuentra en el apartado de Mi Actividad."):$("#info_proc_text").html("La solicitud se ha rechazado con éxito, en caso de ser necesario, recuerde al usuario que, el estado de esta solicitud se encuentra en el apartado de Mi Actividad."):$("#info_proc_text").html("Hubo un error en el proceso, inténtelo más tarde.")},error:function(e,a,t){console.error("Error en la solicitud AJAX:",t),alert("Hubo un problema al procesar la solicitud."),window.location.href="admin_solicitudes"}})}))}));