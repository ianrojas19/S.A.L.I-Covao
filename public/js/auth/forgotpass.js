$(document).ready((function(){[...document.querySelectorAll(".toast")].map((e=>new bootstrap.Toast(e,{})));$("#email_rec").on("input change",(function(){$(this).val($(this).val().toLowerCase()),""!==$(this).val()&&$(this).val().includes("@covao.ed.cr")?($(this).addClass("is-valid").removeClass("is-invalid"),$("#valid_msg").html("Correo institucional válido"),$("#send_rec_code").prop("disabled",!1)):($(this).removeClass("is-valid").removeClass("is-invalid"),$("#send_rec_code").prop("disabled",!0))}));const e=new Audio("./public/assets/audio/success.mp3");$("#send_rec_code").on("click",(function(){$("#send_rec_code").prop("disabled",!0).html("Procesando..."),$.ajax({url:"contraseña",type:"POST",data:{action_type:"send_rec_code",email_to_rec:$("#email_rec").val()},success:function(s){"user_not_found"==s?$("#email_rec").addClass("is-invalid").removeClass("is-valid"):"mail_sent"==s&&(e.play(),$("#mail_sent_toast").toast("show"),$("#send_rec_code").remove(),$("#verify_code").removeClass("d-none"),$("#email_rec").removeClass("is-invalid").addClass("is-valid").prop("readonly",!0),$("#valid_msg").html(""),$("#code_rec").prop("disabled",!1),$("#mail_rc").text($("#email_rec").val()))},error:function(e){alert("El proceso no pudo completarse, intentelo de nuevo"),location.href="contraseña"}})})),$("#code_rec").on("input change",(function(){""!==$(this).val()&&$(this).val().length>=5&&$(this).val().length<6?$("#verify_code").prop("disabled",!1):$("#verify_code").prop("disabled",!0)})),$("#verify_code").on("click",(function(){if($("#verify_code").prop("disabled",!0).html("Procesando..."),""!==$("#code_rec").val()||$("#code_rec").val().length>5){let s=parseInt($("#code_rec").val());$.ajax({url:"contraseña",type:"POST",data:{action_type:"confirm_rec_code",code_given:s},success:function(s){"code_correct"==s?($("#code_rec").addClass("is-valid").removeClass("is-invalid"),e.play(),setTimeout((()=>{$("#rs_stage_1").remove(),$("#verify_code").remove(),$("#rs_stage_2").removeClass("d-none"),$("#change_psw").removeClass("d-none"),$("#goto_home").html("Cancelar")}),1500)):($("#code_rec").addClass("is-invalid"),$("#verify_code").html("Confirmar"),setTimeout((()=>{$("#code_rec").removeClass("is-invalid")}),4e3))},error:function(e){alert("El proceso no pudo completarse, intentelo de nuevo"),location.href="contraseña"}})}else $("#code_rec").addClass("is-invalid"),$("#verify_code").html("Confirmar"),setTimeout((()=>{$("#code_rec").removeClass("is-invalid")}),4e3)})),$(".pass_fields").on("input change",(function(){""!=$("#new_pss").val()&&""!=$("#new_pss_conf").val()&&$("#new_pss").val()==$("#new_pss_conf").val()?$("#change_psw").prop("disabled",!1):$("#change_psw").prop("disabled",!0)})),$("#change_psw").on("click",(function(){""!=$("#new_pss").val()&&""!=$("#new_pss_conf").val()&&$("#new_pss").val()==$("#new_pss_conf").val()?($("#goto_home").remove(),$("#change_psw").prop("disabled",!0).html("Restableciendo...").addClass("w-100"),$("#new_pss").removeClass("is-invalid").addClass("is-valid"),$("#new_pss_conf").removeClass("is-invalid").addClass("is-valid"),$.ajax({url:"contraseña",type:"POST",data:{action_type:"restablish_pass",new_pss:$("#new_pss").val()},success:function(s){e.play(),$("#info_modal").modal("show"),s?$("#process_msg").html("La contraseña ha sido restablecida con éxito."):$("#process_msg").html("La contraseña no pudo ser restablecida, inténtelo más tarde.")},error:function(e){alert("El proceso no pudo completarse, intentelo de nuevo"),location.href="contraseña"}})):(""!=$("#new_pss").val()&&$("#new_pss").addClass("is-invalid"),""==$("#new_pss_conf").val()&&$("#new_pss").val()==$("#new_pss_conf").val()||$("#new_pss_conf").addClass("is-invalid"))}))}));