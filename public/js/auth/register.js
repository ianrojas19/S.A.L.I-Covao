$(document).ready((function(){let e=[],t=[],s=[];$.ajax({url:"registro",type:"POST",data:{action_type:"get_users"},dataType:"json",success:function(n){e=n,e.forEach((e=>{t.push(e[0]),s.push(e[2])}))},error:function(e){alert("Error al obtener usuarios:",e)}});const n=document.getElementById("accept-tyc"),a=document.getElementById("stage-inicio"),l=document.getElementById("stage-personal"),i=document.getElementById("stage-credenciales"),o=document.getElementById("stage-contacto"),d=document.getElementById("btn-action-next"),r=document.getElementById("btn-action-back"),c=document.getElementById("confirm_register");a.style.transition="0.3s all ease",l.style.transition="0.3s all ease",i.style.transition="0.3s all ease",o.style.transition="0.3s all ease";let u=1,m=0;function y(e){switch([a,l,i,o].forEach((e=>{e.style.display="none",e.style.opacity=0})),e){case 1:a.style.display="block",setTimeout((()=>{a.style.opacity=1}),50);break;case 2:l.style.display="block",setTimeout((()=>{l.style.opacity=1}),50);break;case 3:i.style.display="block",setTimeout((()=>{i.style.opacity=1}),50);break;case 4:o.style.display="block",setTimeout((()=>{o.style.opacity=1}),50)}r.style.display=1===e||2===e?"none":"grid",d.style.display=4===e?"none":"grid",c.style.display=4===e?"grid":"none"}n.addEventListener("click",(function(){d.style.backgroundColor=n.checked?"#1B4B76":"#919191"})),d.addEventListener("click",(function(){u<4&&n.checked?(u+=1,$("#btn-action-next").html("Siguiente"),y(u)):n.checked||(r.style.display="none")})),r.addEventListener("click",(function(){m=0,u>1&&(u-=1),y(u)}));const v=document.getElementById("foto_perfil"),g=document.getElementById("uploaded_photo"),p=document.getElementById("userRol"),C=document.getElementById("userEspecialidad_cont"),f=document.getElementById("userEspecialidad"),E=document.querySelector("[data-esp-op-1]").value,I=document.getElementById("userCedula"),b=document.getElementById("userNombreCompleto"),h=document.getElementById("userCorreoInstitucional"),B=document.getElementById("userCorreoInstitucionalPass"),_=document.getElementById("userCorreoInstitucionalConfPass"),k=(document.getElementById("userCorreoContacto"),document.getElementById("userTelefonoContacto")),T=document.getElementById("registro_spinner");v.addEventListener("change",(function(){const e=v.files[0];if(e&&["image/jpg","image/jpeg","image/png","image/webp"].includes(e.type)){const t=URL.createObjectURL(e);g.src=t}else alert("Solo puedes ingresar una imagen como foto de perfil"),v.value=""})),d.addEventListener("click",(function(){m=0,3===u&&(""===I.value||I.value.length<9||t.includes(I.value)||!/^\d+$/.test(I.value)?(m+=1,u=2,t.includes(I.value)?($("#ifb_ced").html("Esta cédula pertenece a otro usuario"),$("#userCedula").addClass("is-invalid")):($("#ifb_ced").html("Esta cédula no tiene un formato correcto"),$("#userCedula").addClass("is-invalid"))):$("#userCedula").addClass("is-valid").removeClass("is-invalid"),""===b.value?(m+=1,u=2,$("#ifb_nom").html("Ingrese el nombre del usuario"),$("#userNombreCompleto").addClass("is-invalid")):$("#userNombreCompleto").addClass("is-valid").removeClass("is-invalid"),y(u)),4===u&&(""===h.value||h.value.length<15||!h.value.endsWith("@covao.ed.cr")||s.includes(h.value)?(m+=1,u=3,s.includes(h.value)?($("#ifb_ci").html("Este correo institucional pertenece a otro usuario"),$("#userCorreoInstitucional").addClass("is-invalid")):($("#ifb_ci").html("Este correo institucional no pertenece a @covao.ed.cr"),$("#userCorreoInstitucional").addClass("is-invalid"))):$("#userCorreoInstitucional").addClass("is-valid").removeClass("is-invalid"),""===B.value||B.value.length<8?(m+=1,u=3,$("#ifb_cip").html("Ingrese una contraseña válida"),$("#userCorreoInstitucionalPass").addClass("is-invalid")):$("#userCorreoInstitucionalPass").addClass("is-valid").removeClass("is-invalid"),_.value!==B.value||""===_.value?(m+=1,u=3,$("#ifb_cifp").html("Las contraseñas no coinciden"),$("#userCorreoInstitucionalConfPass").addClass("is-invalid")):$("#userCorreoInstitucionalConfPass").addClass("is-valid").removeClass("is-invalid"),y(u))})),$(".in_number").on("input",(function(){this.value=this.value.replace(/\D/g,"")})),$("#userTelefonoContacto").removeClass("is-valid").removeClass("is-invalid"),$("#confirm_register").on("click",(function(e){e.preventDefault(),""===k.value||k.value.length<8||!/^[2867]/.test(k.value)?(m+=1,u=4,$("#ifb_tel").html("El nùmero telefónico ingresado no es válido"),$("#userTelefonoContacto").addClass("is-invalid")):$("#userTelefonoContacto").addClass("is-valid").removeClass("is-invalid"),y(u),0===m&&($("#confirm_register").prop("disabled",!0),c.children[0].style.display="none",r.style.display="none",T.style.display="",setTimeout((()=>{$("#form_registro").submit();$("#confirm_register").off();}),100))})),p.addEventListener("change",(function(){"Profesor"===p.value?(C.style.display="block",f.value=E):(C.style.display="none",f.value="Administrador")}))}));