$(document).ready((function(){const sonido_exito = new Audio("./public/assets/audio/success.mp3");$("#app_year").html((new Date).getFullYear()),$("#module_title").html("Retiro de Llaves"),setTimeout((()=>{location.href="profesor"}),12e4);let e=[],o=[];let n=(new Date).getDay();sch.forEach((r=>{if(null==e)e=[r[5]];else if(!function(o){let n=!1;return e.forEach((e=>{e[0]!=o||(n=!0)})),n}(r[5])&&999!==r[5]&&r[0]==n){let n,a=null;aulas.forEach((e=>{if(r[5]==e.numeroLlave)return n=`Llave N°${e.numeroLlave} - ${e.nombreAula}`,void(a=e.isTaken)})),e.push([r[5],n,a]),0==a&&o.push(r[5])}}));$('#cancel_retire').on('click', function(){$('#cancel_retire').addClass('w-100').html('Cancelando retiro...');$('#finish_key_retire').remove().addClass('d-none');});new MutationObserver(((n,r)=>{if($("#choose_key_to_retire").length&&$("#code_2fa").length){if(r.disconnect(),$('main').removeClass('justify-content-center'),0===e.length)$("#no_keys_modal").modal("show");else{function a(){$(this).prop("checked")?o.push($(this).val()):0===o.filter((e=>e!=$(this).val())).length?($(this).prop("checked",!0),alert("Debe elegir al menos 1 llave para retirar")):o=o.filter((e=>e!=$(this).val()))}$("#ingr1").removeClass("d-none"),$("#check_key_1").val(e[0][0]),1==e[0][2]?$("#key_name_1").val(`Ocupada · ${e[0][1]} `).prop("disabled",!0):$("#key_name_1").val(e[0][1]),1==e[0][2]?$("#check_key_1").prop("disabled",!0).prop("checked",!1):$("#ingr1 .input-group-text").removeClass("bg-secondary"),$("#check_key_1").on("change",a),null==e[1]?$("#ingr2").remove():($("#ingr2").removeClass("d-none"),$("#check_key_2").val(e[1][0]),1==e[1][2]?$("#key_name_2").val(`Ocupada · ${e[1][1]} `).prop("disabled",!0):$("#key_name_2").val(e[1][1]),1==e[1][2]?$("#check_key_2").prop("disabled",!0).prop("checked",!1):$("#ingr2 .input-group-text").removeClass("bg-secondary"),$("#check_key_2").on("change",a)),null==e[2]?$("#ingr3").remove():($("#ingr3").removeClass("d-none"),$("#check_key_2").val(e[2][0]),console.log(e[2][1]),1==e[2][2]?$("#key_name_3").val(`Ocupada · ${e[2][1]} `).prop("disabled",!0):$("#key_name_3").val(e[2][1]),1==e[2][2]?$("#check_key_3").prop("disabled",!0).prop("checked",!1):$("#ingr3 .input-group-text").removeClass("bg-secondary"),$("#check_key_3").on("change",a)),null==e[3]?$("#ingr4").remove():($("#ingr4").removeClass("d-none"),$("#check_key_2").val(e[3][0]),1==e[3][2]?$("#key_name_4").val(`Ocupada · ${e[3][1]} `).prop("disabled",!0):$("#key_name_4").val(e[3][1]),1==e[3][2]?$("#check_key_4").prop("disabled",!0).prop("checked",!1):$("#ingr4 .input-group-text").removeClass("bg-secondary"),$("#check_key_4").on("change",a)),null==e[4]?$("#ingr5").remove():($("#ingr5").removeClass("d-none"),$("#check_key_2").val(e[4][0]),1==e[4][2]?$("#key_name_5").val(`Ocupada · ${e[4][1]} `).prop("disabled",!0):$("#key_name_5").val(e[4][1]),1==e[4][2]?$("#check_key_5").prop("disabled",!0).prop("checked",!1):$("#ingr5 .input-group-text").removeClass("bg-secondary"),$("#check_key_5").on("change",a))}let c,i="";if(e.forEach((e=>{1==e[2]&&i++})),e.length==i)$("#retire_available").remove();else{async function t(){try{const e=await $.ajax({url:"profesor_retiro",type:"POST",data:{action_type:"getretcode"},dataType:"json"});return c=e.retiro_llave_access_code_mfa,c}catch(e){alert("Hubo un error en la obtención del código de retiro, inténtelo de nuevo"),location.href="profesor"}}$("#no_code_container").remove(),async function(){const e=await t(),o=Math.floor(4*Math.random())+1;for(let n=1;n<=4;n++){const r=n===o?e:`${Math.floor(10*Math.random())}${Math.floor(10*Math.random())}`;$(`#num_cod_${n}`).html(r),$(`#box_of_code_${n}`).attr("data-code",r)}}(),$("#finish_key_retire").hide();let s=0;async function l(e){const n=await t();$(`#box_of_code_${e}`).data("code")==n?($(`#box_of_code_${e}`).html('<svg\n                        class="appear"\n                        xmlns="http://www.w3.org/2000/svg"\n                        width="50"\n                        height="50"\n                        viewBox="0 0 24 24"\n                        fill="none"\n                        stroke="green"\n                        stroke-width="2"\n                        stroke-linecap="round"\n                        stroke-linejoin="round"\n                        >\n                        <path d="M5 12l5 5l10 -10" />\n                        </svg>'),$("#success_keys_modal").modal("show"),$("#finish_key_retire").show(),$("#finish_key_retire_keys").text(o.join("-"))):(s++,$(`#box_of_code_${e}`).html('<svg\n                        class="appear"\n                        xmlns="http://www.w3.org/2000/svg"\n                        width="50"\n                        height="50"\n                        viewBox="0 0 24 24"\n                        fill="none"\n                        stroke="red"\n                        stroke-width="2"\n                        stroke-linecap="round"\n                        stroke-linejoin="round"\n                      >\n                        <path d="M18 6l-12 12" />\n                        <path d="M6 6l12 12" />\n                      </svg>'),s>2&&$("#try_again").modal("show"))}$("#box_of_code_1").on("click",(function(){l(1)})),$("#box_of_code_2").on("click",(function(){l(2)})),$("#box_of_code_3").on("click",(function(){l(3)})),$("#box_of_code_4").on("click",(function(){l(4)})),$("#finish_key_retire").on("click",(function(){$("#cancel_retire").remove(),$("#finish_key_retire").addClass("w-100").removeClass("w-50").attr("disabled",!0).html("Procesando..."),$.ajax({url:"profesor_retiro",type:"POST",data:{action_type:"process_retiro",key1:o[0],key2:o[1]||null,key3:o[2]||null,key4:o[3]||null,key5:o[4]||null},success:function(e){console.log(e),"OK"===e&&($("#finish_key_retire").html("Retiro realizado").removeClass("btn-primary").addClass("btn-success"),sonido_exito.play(),setTimeout((()=>{location.href="profesor"}),1e3))},error:function(e){console.log(e),alert("Hubo un error en el proceso del retiro de llaves, intentelo de nuevo"),location.href="profesor"}})}))}}})).observe(document.body,{childList:!0,subtree:!0})}));